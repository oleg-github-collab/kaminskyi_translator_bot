# üí≥ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–ª–∞—Ç—ñ–∂–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ Stripe

## üöÄ –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

### ‚úÖ –©–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ:

1. **–ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∞ Stripe —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è**
   - –†–µ–∞–ª—å–Ω—ñ –ø–ª–∞—Ç—ñ–∂–Ω—ñ —Å–µ—Å—ñ—ó –∑–∞–º—ñ—Å—Ç—å –∑–∞–≥–ª—É—à–æ–∫
   - –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∫–∞—Ä—Ç, Google Pay, Apple Pay
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —á–µ–∫—ñ–≤

2. **–û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π UI –¥–ª—è Telegram**
   - –ü–ª–∞—Ç—ñ–∂–Ω–µ –≤—ñ–∫–Ω–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –ø—Ä—è–º–æ –≤ Telegram —á–µ—Ä–µ–∑ –≤–µ–±-–ø–µ—Ä–µ–≥–ª—è–¥–∞—á
   - –ö—Ä–∞—Å–∏–≤—ñ HTML —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —É—Å–ø—ñ—Ö—É/—Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è –≤—ñ–∫–æ–Ω

3. **–ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –¥–æ—Å–≤—ñ–¥**
   - –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–ª–∞—Ç–µ–∂—ñ
   - –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏ –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
   - –°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∑ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç–∏

4. **–ù–∞–¥—ñ–π–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫**
   - –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö
   - –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –ø–ª–∞—Ç—ñ–∂–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
   - Graceful error handling –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–º–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏
   - –û–∫—Ä–µ–º—ñ –ª–æ–≥–∏ –¥–ª—è –ø–ª–∞—Ç–µ–∂—ñ–≤

5. **Webhook —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—ñ–≤
   - –û–±—Ä–æ–±–∫–∞ expired —Å–µ—Å—ñ–π
   - –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º

## üîß –ù–µ–æ–±—Ö—ñ–¥–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. Stripe –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

```bash
# –£ .env —Ñ–∞–π–ª—ñ –¥–æ–¥–∞–π—Ç–µ:
STRIPE_SECRET_KEY=sk_test_...  # –í–∞—à —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á Stripe
STRIPE_WEBHOOK_SECRET=whsec_...  # Webhook —Å–µ–∫—Ä–µ—Ç
WEBHOOK_URL=https://yourdomain.com  # –í–∞—à –¥–æ–º–µ–Ω
```

### 2. Stripe Dashboard

1. –£–≤—ñ–π–¥—ñ—Ç—å –≤ [Stripe Dashboard](https://dashboard.stripe.com/)
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ **Developers > Webhooks**
3. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π endpoint: `https://yourdomain.com/webhook/stripe`
4. –í–∏–±–µ—Ä—ñ—Ç—å –ø–æ–¥—ñ—ó:
   - `checkout.session.completed`
   - `checkout.session.expired`
5. –°–∫–æ–ø—ñ—é–π—Ç–µ webhook secret —É `.env`

### 3. –î–æ–º–µ–Ω —Ç–∞ SSL

- –û–±–æ–≤'—è–∑–∫–æ–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ HTTPS (SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç)
- –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ success/cancel URL
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –≤–∞—à–æ–≥–æ –¥–æ–º–µ–Ω—É

## üéØ –ö–ª—é—á–æ–≤—ñ —Ñ–∞–π–ª–∏

### `handlers/payment.py`
- **`process_payment()`** - –≥–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –æ–±—Ä–æ–±–∫–∏ –ø–ª–∞—Ç–µ–∂—ñ–≤
- **`payment_help()`** - —Å–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏
- **`start_translation()`** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–æ—á–∞—Ç–æ–∫ –ø—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏
- **`payment_details()`** - –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
- **`contact_support()`** - –∫–æ–Ω—Ç–∞–∫—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏

### `utils/payment_utils.py`
- **`create_payment_session()`** - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è Stripe —Å–µ—Å—ñ–π
- **`verify_payment()`** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –ø–ª–∞—Ç–µ–∂—É
- **`calculate_price()`** - —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ
- **`format_payment_receipt()`** - —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–µ–∫—ñ–≤

### `handlers/webhook.py`
- **`stripe_webhook()`** - –æ–±—Ä–æ–±–∫–∞ Stripe –ø–æ–¥—ñ–π
- **`success_page()`** - HTML —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —É—Å–ø—ñ—à–Ω–æ—ó –æ–ø–ª–∞—Ç–∏
- **`cancel_page()`** - HTML —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —Å–∫–∞—Å–æ–≤–∞–Ω–æ—ó –æ–ø–ª–∞—Ç–∏
- **`info_page()`** - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑ —Ü—ñ–Ω–∞–º–∏

### `utils/error_handler.py`
- **`@payment_error_handler`** - –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫
- **`validate_payment_data()`** - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–ª–∞—Ç—ñ–∂–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- **`log_payment_action()`** - –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥—ñ–π
- **`PaymentValidator`** - –∫–ª–∞—Å –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

### `utils/template_utils.py`
- **`TemplateRenderer`** - —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ HTML —à–∞–±–ª–æ–Ω—ñ–≤
- **`render_success_page()`** - –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —É—Å–ø—ñ—Ö—É
- **`render_cancel_page()`** - –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
- **`validate_template_files()`** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —à–∞–±–ª–æ–Ω—ñ–≤

### `templates/` –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
- **`payment_success.html`** - –∫—Ä–∞—Å–∏–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —É—Å–ø—ñ—à–Ω–æ—ó –æ–ø–ª–∞—Ç–∏
- **`payment_cancel.html`** - —Å—Ç–∏–ª—ñ–∑–æ–≤–∞–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
- **`payment_info.html`** - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑ —Ü—ñ–Ω–∞–º–∏

## üì± –ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –ø–æ—Ç—ñ–∫

1. **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É** ‚Üí –ê–Ω–∞–ª—ñ–∑ —Ç–µ–∫—Å—Ç—É
2. **–í–∏–±—ñ—Ä –º–æ–¥–µ–ª—ñ** ‚Üí –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ü—ñ–Ω–∏
3. **–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è** ‚Üí –î–µ—Ç–∞–ª—ñ –æ–ø–ª–∞—Ç–∏
4. **–û–ø–ª–∞—Ç–∞** ‚Üí Stripe –≤—ñ–∫–Ω–æ (–≤ Telegram)
5. **–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–æ—á–∞—Ç–æ–∫ –ø–µ—Ä–µ–∫–ª–∞–¥—É

## üîç –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

### Stripe –¥–ª—è Telegram
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `ui_mode: 'hosted'` –¥–ª—è –∫—Ä–∞—â–æ—ó —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
- –ï–∫—Å–ø—ñ—Ä–∞—Ü—ñ—è —Å–µ—Å—ñ–π —á–µ—Ä–µ–∑ 30 —Ö–≤–∏–ª–∏–Ω
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥—ñ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∞–¥—Ä–µ—Å–∏

### HTML –®–∞–±–ª–æ–Ω–∏
- –ö—Ä–∞—Å–∏–≤—ñ responsive —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —É—Å–ø—ñ—Ö—É/—Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è –≤—ñ–∫–æ–Ω —á–µ—Ä–µ–∑ N —Å–µ–∫—É–Ω–¥
- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑ —Ü—ñ–Ω–∞–º–∏ —Ç–∞ –¥–µ—Ç–∞–ª—è–º–∏
- Fallback –Ω–∞ –±–∞–∑–æ–≤–∏–π HTML —É —Ä–∞–∑—ñ –ø–æ–º–∏–ª–æ–∫
- –ö–µ—à—É–≤–∞–Ω–Ω—è —à–∞–±–ª–æ–Ω—ñ–≤ –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ

### –ë–µ–∑–ø–µ–∫–∞
- –í—Å—ñ –¥–∞–Ω—ñ –≤–∞–ª—ñ–¥—É—é—Ç—å—Å—è –ø–µ—Ä–µ–¥ –æ–±—Ä–æ–±–∫–æ—é
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –ø–ª–∞—Ç—ñ–∂–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
- –°–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–æ–≥–æ –≤–≤–æ–¥—É
- –ó–∞—Ö–∏—â–µ–Ω—ñ webhook'–∏ –∑ –ø—ñ–¥–ø–∏—Å–∞–º–∏

### –õ–æ–≥—É–≤–∞–Ω–Ω—è
```
logs/
‚îú‚îÄ‚îÄ bot.log          # –ó–∞–≥–∞–ª—å–Ω—ñ –ª–æ–≥–∏
‚îî‚îÄ‚îÄ payment.log      # –ü–ª–∞—Ç—ñ–∂–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

1. **–¢–µ—Å—Ç Stripe**:
   ```
   –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ñ –∫–∞—Ä—Ç–∫–∏:
   4242 4242 4242 4242 (Visa)
   5555 5555 5555 4444 (Mastercard)
   ```

2. **–¢–µ—Å—Ç webhook'—ñ–≤**:
   ```bash
   # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Stripe CLI
   stripe listen --forward-to localhost:8000/webhook/stripe
   ```

3. **–õ–æ–∫–∞–ª—å–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è**:
   ```bash
   # –ó–∞–ø—É—Å—Ç—ñ—Ç—å ngrok –¥–ª—è HTTPS
   ngrok http 8000
   ```

4. **–¢–µ—Å—Ç HTML —à–∞–±–ª–æ–Ω—ñ–≤**:
   ```bash
   # –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —à–∞–±–ª–æ–Ω—ñ–≤
   python3 -c "from utils.template_utils import validate_template_files; print(validate_template_files())"
   
   # –î–æ—Å—Ç—É–ø –¥–æ —Å—Ç–æ—Ä—ñ–Ω–æ–∫:
   # http://localhost:8000/success?user_id=123&amount=2.50&model=epic&char_count=5000
   # http://localhost:8000/cancel?user_id=123&reason=user_cancelled
   # http://localhost:8000/info
   ```

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è:
- –£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å –ø–ª–∞—Ç–µ–∂—ñ–≤
- –ß–∞—Å –æ–±—Ä–æ–±–∫–∏
- –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–º–∏–ª–æ–∫
- –ö–æ–Ω–≤–µ—Ä—Å—ñ—è –ø–æ –º–æ–¥–µ–ª—è—Ö

### –õ–æ–≥–∏ –ø–ª–∞—Ç–µ–∂—ñ–≤:
```python
# –ü—Ä–∏–∫–ª–∞–¥ –ª–æ–≥-–∑–∞–ø–∏—Å—É
{
    "action": "payment_completed",
    "user_id": 12345,
    "timestamp": 1703087234,
    "details": {
        "amount": 2.50,
        "model": "epic",
        "char_count": 5000
    }
}
```

## üö® –í–∞–∂–ª–∏–≤—ñ –Ω–æ—Ç–∞—Ç–∫–∏

1. **–ù—ñ–∫–æ–ª–∏ –Ω–µ –∫–æ–º—ñ—Ç—å—Ç–µ** —Ä–µ–∞–ª—å–Ω—ñ API –∫–ª—é—á—ñ
2. **–ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ** HTTPS —É –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ** webhook'–∏ –≤ Stripe Dashboard
4. **–ú–æ–Ω—ñ—Ç–æ—Ä—Ç–µ** –ª–æ–≥–∏ –ø–ª–∞—Ç–µ–∂—ñ–≤ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º
5. **–¢–µ—Å—Ç—É–π—Ç–µ** –Ω–∞ staging –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ—î–º

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

- **Email**: support@kaminskyi.ai
- **Telegram**: @KaminskyiSupport
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**: [Stripe Docs](https://stripe.com/docs)

---
**–°—Ç–≤–æ—Ä–µ–Ω–æ –∑ ‚ù§Ô∏è –¥–ª—è –Ω–∞–π–∫—Ä–∞—â–æ–≥–æ –¥–æ—Å–≤—ñ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ Telegram**